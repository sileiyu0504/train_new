# Experiment Playbook (Server)

## Code changes
- `ultralytics/data/dataset.py`: add per-image min-max normalization (`depth_per_image_norm=True` by default) so real RGBD and pseudo depth share the same [0,1] distribution.
- Added dataset configs: `data_rgb.yaml`, `data_rgbd_pseudo.yaml`, `data_test_real.yaml`, `data_test_hn.yaml`.
- Added scripts in `scripts/` for list generation, training, validation, HN prediction, FP counting.

## Directory expectations
```
/mnt/e/Desktop/train_new
├─ datasets/
│   ├─ YOLO_RGB_carton/      # RGB + pseudo depth (Depth Anything)
│   ├─ YOLO_RGBD_carton/     # Real RGB-D (sensor)
│   └─ YOLO_HN/              # Hard negatives (labels empty)
├─ train_full.txt train_50.txt train_20.txt   # generated by scripts/prepare_lists.sh
├─ logs/                                          # stdout logs
└─ runs/                                          # YOLO outputs
```

## One-time prep
```bash
cd /mnt/e/Desktop/train_new
chmod +x scripts/*.sh scripts/count_fp.py
scripts/prepare_lists.sh      # builds train_full/50/20 with seed=42
```

## Training (4 runs)
```bash
scripts/train_run1_baseline.sh    # RGB, full data
scripts/train_run2_rgbd_full.sh   # RGBD, full pseudo depth
scripts/train_run3_rgbd_50.sh     # RGBD, 50% pseudo depth
scripts/train_run4_rgbd_20.sh     # RGBD, 20% pseudo depth
```
Each writes logs to `logs/run*.log` and weights to `runs/exp/<run>/weights/best.pt`.

## Evaluation on real RGB-D test set
```bash
scripts/val_test_real.sh    # produces logs/test_*_real.log, save_json=true
```

## HN robustness (FP count)
```bash
scripts/predict_hn.sh       # save_txt predictions to runs/hn/<run>/labels
python scripts/count_fp.py  # prints FP totals for baseline vs RGBD
```

## What to plot/report
- From `logs/test_*_real.log` (or `runs/exp/*/results.csv`): mAP50 / mAP50-95 for Run1..Run4 on real test set.
- From `scripts/count_fp.py`: FP counts on HN set (baseline vs RGBD).
- Data efficiency story: Run3 (50%) vs Run1 (100% RGB) on real test mAP; Run4 (20%) for “low data” point.

## Notes
- Depth normalization is per-image; set `depth_per_image_norm=False` in data yaml if you need fixed `depth_scale` only.
- HN depth is optional; if you generate pseudo depth for HN, uncomment `depth` in `data_test_hn.yaml`.
